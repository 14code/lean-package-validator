#!/usr/bin/env php
<?php

$binFile = __DIR__ . DIRECTORY_SEPARATOR . 'lean-package-validator';

$options = getopt('v:', ['version:']);

if ($options === []) {
    echo 'No version set. Provide one via --version|-v.' . PHP_EOL;
    exit(1);
}
$version = isset($options['version']) ? $options['version'] : $options['v'];

$fileContent = file_get_contents($binFile);
$fileContent = preg_replace(
    '/(.*define.*VERSION.*)/',
    "define('VERSION', '$version');",
    $fileContent
);

file_put_contents($binFile, $fileContent);

echo "Set version in {$binFile} to {$version}." . PHP_EOL;
echo "Run git add bin/lean-package-validator && git commit -m 'Release {$version}' && git tag v{$version} to release." . PHP_EOL;
